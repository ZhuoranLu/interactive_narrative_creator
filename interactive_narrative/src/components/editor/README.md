# ğŸ® Interactive Narrative Template Editor

è¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¯è§†åŒ–æ¸¸æˆæ¨¡æ¿ç¼–è¾‘å™¨ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡æ‹–æ‹½ã€å±æ€§è°ƒæ•´å’ŒAIåŠ©æ‰‹æ¥åˆ›å»ºå’Œç¼–è¾‘äº’åŠ¨å°è¯´æ¸¸æˆæ¨¡æ¿ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
ğŸ“¦ Template Editor System
â”œâ”€â”€ ğŸ¨ Frontend (React + Chakra UI)
â”‚   â”œâ”€â”€ TemplateEditor.tsx        # ä¸»ç¼–è¾‘å™¨ç»„ä»¶
â”‚   â”œâ”€â”€ ChatAssistant.tsx         # AIèŠå¤©åŠ©æ‰‹
â”‚   â”œâ”€â”€ EffectsPanel.tsx          # WebGLç‰¹æ•ˆé¢æ¿
â”‚   â””â”€â”€ README.md                 # è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ ğŸ”§ Backend (FastAPI)
â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â””â”€â”€ editor.py             # ç¼–è¾‘å™¨APIè·¯ç”±
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â””â”€â”€ editor.py             # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ llm_assistant.py      # LLMåŠ©æ‰‹æœåŠ¡
â”‚   â””â”€â”€ deps.py                   # å…±äº«ä¾èµ–
â””â”€â”€ ğŸ¯ Features
    â”œâ”€â”€ å¯è§†åŒ–ç¼–è¾‘å™¨
    â”œâ”€â”€ å®æ—¶åä½œ (WebSocket)
    â”œâ”€â”€ AIåŠ©æ‰‹é›†æˆ
    â”œâ”€â”€ WebGLç‰¹æ•ˆç³»ç»Ÿ
    â””â”€â”€ æ¨¡æ¿å¯¼å‡ºåŠŸèƒ½
```

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### ğŸ¨ å¯è§†åŒ–ç¼–è¾‘å™¨
- **æ‹–æ‹½æ“ä½œ**: ä»ç»„ä»¶åº“æ‹–æ‹½å…ƒç´ åˆ°ç”»å¸ƒ
- **å±æ€§é¢æ¿**: å®æ—¶è°ƒæ•´ä½ç½®ã€å°ºå¯¸ã€æ ·å¼ç­‰å±æ€§
- **å›¾å±‚ç®¡ç†**: ç®¡ç†å…ƒç´ å±‚çº§ã€å¯è§æ€§ã€é”å®šçŠ¶æ€
- **ç¼©æ”¾æ§åˆ¶**: æ”¯æŒç”»å¸ƒç¼©æ”¾å’Œé€‚é…ä¸åŒå±å¹•å°ºå¯¸

### ğŸ¤– AIè®¾è®¡åŠ©æ‰‹
- **è‡ªç„¶è¯­è¨€ç†è§£**: ç†è§£ç”¨æˆ·çš„è®¾è®¡éœ€æ±‚
- **æ™ºèƒ½å‘½ä»¤ç”Ÿæˆ**: è‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„ç¼–è¾‘å‘½ä»¤
- **å®æ—¶å»ºè®®**: æä¾›ç›¸å…³çš„è®¾è®¡å»ºè®®å’Œå¿«æ·æ“ä½œ
- **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**: æ ¹æ®é€‰ä¸­å…ƒç´ æä¾›é’ˆå¯¹æ€§å»ºè®®

### âœ¨ WebGLç‰¹æ•ˆç³»ç»Ÿ
- **è¡€æ»´ç‰¹æ•ˆ**: é€¼çœŸçš„è¡€æ»´æ»´è½åŠ¨ç”»
- **ç²’å­ç³»ç»Ÿ**: åŠ¨æ€ç²’å­èƒŒæ™¯æ•ˆæœ
- **å‘å…‰æ•ˆæœ**: æŸ”å’Œçš„å‘å…‰è¾¹ç¼˜
- **æ¶Ÿæ¼ªæ•ˆæœ**: ç‚¹å‡»äº§ç”Ÿçš„æ°´æ³¢çº¹æ‰©æ•£
- **é—ªç”µæ•ˆæœ**: æˆå‰§æ€§çš„é—ªç”µèƒŒæ™¯
- **çƒŸé›¾æ•ˆæœ**: ç¼“æ…¢é£˜æ•£çš„çƒŸé›¾åŠ¨ç”»

### ğŸ”„ å®æ—¶åä½œ
- **WebSocketè¿æ¥**: å®æ—¶åŒæ­¥ç¼–è¾‘çŠ¶æ€
- **å¤šç”¨æˆ·æ”¯æŒ**: æ”¯æŒå¤šäººåŒæ—¶ç¼–è¾‘
- **æ“ä½œå¹¿æ’­**: å®æ—¶å¹¿æ’­å…ƒç´ æ›´æ–°å’Œç‰¹æ•ˆæ·»åŠ 

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¯åŠ¨ç¼–è¾‘å™¨
```bash
# 1. å¯åŠ¨åç«¯æœåŠ¡
cd server
./dev.sh

# 2. å¯åŠ¨å‰ç«¯æœåŠ¡
cd interactive_narrative
npm run dev

# 3. è®¿é—®ç¼–è¾‘å™¨
# http://localhost:5173/editor
```

### åŸºæœ¬æ“ä½œ

#### 1. é€‰æ‹©å’Œç¼–è¾‘å…ƒç´ 
```typescript
// ç‚¹å‡»ç”»å¸ƒä¸­çš„å…ƒç´ è¿›è¡Œé€‰æ‹©
// åœ¨å³ä¾§å±æ€§é¢æ¿ä¸­è°ƒæ•´å±æ€§
// æˆ–ä½¿ç”¨AIåŠ©æ‰‹è¿›è¡Œæ™ºèƒ½è°ƒæ•´
```

#### 2. AIåŠ©æ‰‹å¯¹è¯ç¤ºä¾‹
```
ç”¨æˆ·: "ç»™å¯¹è¯æ¡†æ·»åŠ è¡€æ»´ç‰¹æ•ˆ"
AI: "âœ¨ å¤ªæ£’äº†ï¼æˆ‘æ­£åœ¨ä¸ºå…ƒç´  'dialogue-box' æ·»åŠ è¡€æ»´ç‰¹æ•ˆï¼"

ç”¨æˆ·: "æŠŠèƒŒæ™¯æ”¹æˆçº¢è‰²æ¸å˜"  
AI: "ğŸ¨ å¥½çš„ï¼æˆ‘æ­£åœ¨ä¸ºå…ƒç´  'background' è°ƒæ•´èƒŒæ™¯æ ·å¼ï¼"

ç”¨æˆ·: "è®¾ç½®é€æ˜åº¦ä¸º50%"
AI: "ğŸ”§ æˆ‘æ­£åœ¨ä¸ºå…ƒç´ è°ƒæ•´é€æ˜åº¦å±æ€§ï¼"
```

#### 3. ç‰¹æ•ˆåº”ç”¨
```typescript
// 1. é€‰æ‹©ç›®æ ‡å…ƒç´ 
// 2. æ‰“å¼€ç‰¹æ•ˆé¢æ¿ (ğŸª„ æŒ‰é’®)
// 3. é€‰æ‹©æƒ³è¦çš„ç‰¹æ•ˆ
// 4. æˆ–é€šè¿‡AIåŠ©æ‰‹æè¿°ç‰¹æ•ˆéœ€æ±‚
```

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°ç‰¹æ•ˆ
```typescript
// 1. åœ¨ EffectsPanel.tsx ä¸­æ·»åŠ ç‰¹æ•ˆå®šä¹‰
const newEffect = {
  type: 'customEffect',
  name: 'è‡ªå®šä¹‰ç‰¹æ•ˆ',
  description: 'ç‰¹æ•ˆæè¿°',
  icon: FaIcon,
  color: '#color'
};

// 2. åœ¨ llm_assistant.py ä¸­æ·»åŠ è¯†åˆ«æ¨¡å¼
self.effect_patterns[r'è‡ªå®šä¹‰|ç‰¹æ®Š'] = 'customEffect'

// 3. å®ç°ç‰¹æ•ˆæ¸²æŸ“é€»è¾‘
function applyCustomEffect(element, config) {
  // ç‰¹æ•ˆå®ç°ä»£ç 
}
```

### æ‰©å±•AIåŠ©æ‰‹èƒ½åŠ›
```python
# åœ¨ llm_assistant.py ä¸­æ·»åŠ æ–°çš„æ„å›¾è¯†åˆ«
def _analyze_intent(self, message: str):
    # æ·»åŠ æ–°çš„æ¨¡å¼åŒ¹é…
    if re.search(r'æ–°åŠŸèƒ½|ç‰¹æ®Šæ“ä½œ', message_lower):
        intent["type"] = "new_feature"
        # å¤„ç†é€»è¾‘
    return intent
```

### åˆ›å»ºæ–°ç»„ä»¶ç±»å‹
```typescript
// 1. åœ¨ editor.py schemas ä¸­å®šä¹‰æ•°æ®æ¨¡å‹
class NewElementType(BaseModel):
    # å±æ€§å®šä¹‰

// 2. åœ¨å‰ç«¯æ·»åŠ ç»„ä»¶æ¸²æŸ“é€»è¾‘
const renderNewElement = (element) => {
  // æ¸²æŸ“é€»è¾‘
};

// 3. æ›´æ–°ç»„ä»¶åº“å’Œå›¾æ ‡æ˜ å°„
```

## ğŸ“¡ API æ¥å£

### ç¼–è¾‘å™¨API
```bash
# è·å–æ¨¡æ¿åˆ—è¡¨
GET /api/editor/templates

# åˆ›å»ºé¡¹ç›®
POST /api/editor/projects

# æ›´æ–°å…ƒç´ 
PUT /api/editor/projects/{id}/elements/{elementId}

# æ·»åŠ ç‰¹æ•ˆ
POST /api/editor/projects/{id}/effects

# AIåŠ©æ‰‹å¯¹è¯
POST /api/editor/assistant/chat

# å®æ—¶ç¼–è¾‘ (WebSocket)
WS /api/editor/projects/{id}/live
```

### è¯·æ±‚ç¤ºä¾‹
```javascript
// AIåŠ©æ‰‹å¯¹è¯
const response = await fetch('/api/editor/assistant/chat', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${token}`
  },
  body: JSON.stringify({
    project_id: 'demo',
    message: 'ç»™èŠå¤©æ¡†æ·»åŠ è¡€æ»´ç‰¹æ•ˆ',
    selected_element: 'dialogue-box'
  })
});

// æ·»åŠ ç‰¹æ•ˆ
const effectResponse = await fetch('/api/editor/projects/demo/effects', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${token}`
  },
  body: JSON.stringify({
    type: 'bloodDrop',
    name: 'è¡€æ»´ç‰¹æ•ˆ',
    config: { dropCount: 20, speed: 2, color: '#dc2626' },
    target_element: 'dialogue-box'
  })
});
```

## ğŸ¯ AIåŠ©æ‰‹ä½¿ç”¨æŠ€å·§

### æ”¯æŒçš„å‘½ä»¤ç±»å‹

#### ç‰¹æ•ˆç›¸å…³
```
âœ… "ç»™å¯¹è¯æ¡†æ·»åŠ è¡€æ»´ç‰¹æ•ˆ"
âœ… "ä¸ºèƒŒæ™¯æ·»åŠ ç²’å­ç³»ç»Ÿ"  
âœ… "åˆ›å»ºå‘å…‰è¾¹æ¡†æ•ˆæœ"
âœ… "æ·»åŠ 50ä¸ªè“è‰²ç²’å­"
âœ… "åˆ¶ä½œæ¶Ÿæ¼ªç‚¹å‡»æ•ˆæœ"
```

#### æ ·å¼è°ƒæ•´
```
âœ… "æŠŠèƒŒæ™¯æ”¹æˆçº¢è‰²æ¸å˜"
âœ… "è®¾ç½®é€æ˜åº¦ä¸º70%"
âœ… "ç§»åŠ¨å…ƒç´ åˆ°åæ ‡100,200"
âœ… "æ”¹å˜å¤§å°ä¸º300x200"
âœ… "è°ƒæ•´é¢œè‰²ä¸ºè“è‰²"
```

#### æ™ºèƒ½å»ºè®®
```
âœ… AIä¼šæ ¹æ®å½“å‰é€‰ä¸­å…ƒç´ æä¾›ç›¸å…³å»ºè®®
âœ… æ”¯æŒä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„æ“ä½œæ¨è
âœ… æä¾›å¿«æ·æ“ä½œæŒ‰é’®
```

## ğŸ”§ é…ç½®é€‰é¡¹

### ç‰¹æ•ˆé…ç½®å‚æ•°
```typescript
interface EffectConfig {
  // è¡€æ»´ç‰¹æ•ˆ
  bloodDrop: {
    dropCount: number;    // è¡€æ»´æ•°é‡ (é»˜è®¤: 20)
    speed: number;        // ä¸‹è½é€Ÿåº¦ (é»˜è®¤: 2)
    color: string;        // é¢œè‰² (é»˜è®¤: '#dc2626')
    size: number;         // å¤§å° (é»˜è®¤: 3)
  };
  
  // ç²’å­ç³»ç»Ÿ
  particles: {
    count: number;        // ç²’å­æ•°é‡ (é»˜è®¤: 50)
    speed: number;        // ç§»åŠ¨é€Ÿåº¦ (é»˜è®¤: 1)
    color: string;        // é¢œè‰² (é»˜è®¤: '#60a5fa')
    size: number;         // å¤§å° (é»˜è®¤: 2)
  };
  
  // å‘å…‰æ•ˆæœ
  glow: {
    color: string;        // å‘å…‰é¢œè‰² (é»˜è®¤: '#ff6b9d')
    intensity: number;    // å¼ºåº¦ (é»˜è®¤: 0.8)
    blur: number;         // æ¨¡ç³ŠåŠå¾„ (é»˜è®¤: 20)
  };
}
```

### ç”»å¸ƒé…ç½®
```typescript
interface ViewportConfig {
  width: number;          // ç”»å¸ƒå®½åº¦ (é»˜è®¤: 1920)
  height: number;         // ç”»å¸ƒé«˜åº¦ (é»˜è®¤: 1080)
  scale: number;          // ç¼©æ”¾æ¯”ä¾‹ (é»˜è®¤: 0.4)
}
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### WebSocketè¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ
curl http://localhost:8000/api/editor/templates

# æ£€æŸ¥WebSocketç«¯ç‚¹
# ws://localhost:8000/api/editor/projects/demo/live
```

#### AIåŠ©æ‰‹æ— å“åº”
```python
# æ£€æŸ¥LLMåŠ©æ‰‹æœåŠ¡
python -c "from app.services.llm_assistant import llm_assistant; print('âœ… æœåŠ¡æ­£å¸¸')"

# æŸ¥çœ‹æ—¥å¿—è¾“å‡º
tail -f logs/server.log
```

#### ç‰¹æ•ˆä¸æ˜¾ç¤º
```javascript
// æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
// ç¡®è®¤WebGLæ”¯æŒ
console.log(!!window.WebGLRenderingContext);

// æ£€æŸ¥Canvaså…ƒç´ 
document.querySelectorAll('canvas');
```

## ğŸš€ æœªæ¥è§„åˆ’

### å³å°†æ¨å‡ºçš„åŠŸèƒ½
- [ ] æ›´å¤šWebGLç‰¹æ•ˆé¢„è®¾
- [ ] é«˜çº§åŠ¨ç”»æ—¶é—´è½´ç¼–è¾‘å™¨
- [ ] 3Då…ƒç´ æ”¯æŒ
- [ ] éŸ³é¢‘ç‰¹æ•ˆé›†æˆ
- [ ] å®æ—¶é¢„è§ˆä¼˜åŒ–
- [ ] æ¨¡æ¿å¸‚åœº
- [ ] åä½œæƒé™ç®¡ç†
- [ ] ç‰ˆæœ¬å†å²å’Œå›æ»š

### æŠ€æœ¯ä¼˜åŒ–
- [ ] æ€§èƒ½ä¼˜åŒ–å’Œä»£ç åˆ†å‰²
- [ ] PWAæ”¯æŒ
- [ ] ç§»åŠ¨ç«¯é€‚é…
- [ ] ç¦»çº¿ç¼–è¾‘èƒ½åŠ›
- [ ] æ›´æ™ºèƒ½çš„AIåŠ©æ‰‹

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ LICENSE æ–‡ä»¶

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·æŸ¥çœ‹ CONTRIBUTING.md äº†è§£è¯¦ç»†çš„è´¡çŒ®æŒ‡å—ã€‚

---

**Happy Coding! ğŸ®âœ¨** 