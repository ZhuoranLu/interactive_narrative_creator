# äº¤äº’å¼å™äº‹UGCå¼•æ“ï¼šåç«¯å¼€å‘æŒ‡å—ï¼ˆå‰ç«¯è§†è§’ï¼‰

## ğŸ“‹ æ ‡å‡†åŒ–æ•°æ®ç»“æ„ç¤ºä¾‹

ğŸ”— **é‡è¦å‚è€ƒæ–‡ä»¶**: [example_node_data.json](./example_node_data.json)

ä¸ºäº†ç¡®ä¿å¼€å‘å›¢é˜Ÿä¹‹é—´çš„æ•°æ®ç»“æ„ä¸€è‡´æ€§ï¼Œæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªåŒ…å«**çœŸå®AIç”Ÿæˆæ•°æ®**çš„æ ‡å‡†ç¤ºä¾‹æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶åŒ…å«ï¼š

- âœ… **å®é™…ç”Ÿæˆçš„å®Œæ•´èŠ‚ç‚¹ç¤ºä¾‹** - ç”± `NarrativeGenerator.bootstrap_node()` çœŸå®ç”Ÿæˆ
- ğŸ“– **å®Œæ•´çš„æ•°æ®ç»“æ„å‚è€ƒ** - åŒ…å«æ‰€æœ‰å­—æ®µçš„è¯¦ç»†è¯´æ˜
- ğŸ› ï¸ **APIä½¿ç”¨ç¤ºä¾‹** - æ ¸å¿ƒå‡½æ•°çš„è°ƒç”¨æ–¹æ³•
- ğŸ“ **å¼€å‘è§„èŒƒæŒ‡å—** - IDæ ¼å¼ã€å­—æ®µç±»å‹ç­‰æ ‡å‡†

**æ¨èä½¿ç”¨æ–¹å¼**ï¼š
```python
# åœ¨ä½ çš„ä»£ç ä¸­å‚è€ƒç¤ºä¾‹ç»“æ„
with open('example_node_data.json', 'r', encoding='utf-8') as f:
    examples = json.load(f)
    
# æŸ¥çœ‹çœŸå®çš„èŠ‚ç‚¹ç»“æ„
real_node_structure = examples['narrative_graph_examples']['examples']['ai_generated_complete_node']['node_data']

# æŸ¥çœ‹æ•°æ®ç»“æ„å®šä¹‰
schema_reference = examples['narrative_graph_examples']['data_structure_reference']
```

---

## 1. æ¦‚è¿°

æ¬¢è¿æ¥åˆ°äº¤äº’å¼å™äº‹UGCå¼•æ“çš„åç«¯ã€‚æœ¬æ–‡æ¡£æ—¨åœ¨é˜æ˜åç«¯çš„æ¶æ„ï¼Œå¹¶æŒ‡å¯¼å‰ç«¯å¼€å‘è€…å¦‚ä½•ä¸å…¶äº¤äº’ï¼Œä»¥æ„å»ºä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œã€ç”±ç”¨æˆ·é©±åŠ¨çš„æ•…äº‹åˆ›ä½œå¹³å°ã€‚

æ ¸å¿ƒç†å¿µéå¸¸ç®€å•ï¼š
1.  **ç”Ÿæˆ (Generate)**ï¼šAIæ ¹æ®ç”¨æˆ·çš„åˆ›æ„ï¼Œç”Ÿæˆä¸€ä¸ªåˆå§‹çš„æ•…äº‹"èŠ‚ç‚¹"ï¼ˆåŒ…å«ä¸€ä¸ªåœºæ™¯ã€ç›¸å…³äº‹ä»¶å’Œå¯é€‰åŠ¨ä½œï¼‰ã€‚
2.  **ç¼–è¾‘ (Edit)**ï¼šç”¨æˆ·æ‹¥æœ‰å®Œå…¨çš„åˆ›ä½œè‡ªç”±ï¼Œå¯ä»¥ä¿®æ”¹ã€æ·»åŠ ã€åˆ é™¤æˆ–é‡æ–°ç”ŸæˆèŠ‚ç‚¹çš„ä»»ä½•éƒ¨åˆ†ã€‚
3.  **æ¨è¿› (Advance)**ï¼šå½“ç”¨æˆ·å¯¹å½“å‰èŠ‚ç‚¹æ»¡æ„åï¼Œä»–ä»¬å¯ä»¥é€‰æ‹©ä¸€ä¸ªåŠ¨ä½œæ¥æ¨è¿›æ•…äº‹ï¼ŒAIä¼šæ®æ­¤ç”Ÿæˆä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚

---

## 2. æ ¸å¿ƒç»„ä»¶

åç«¯ä¸»è¦ç”±ä¸¤ä¸ªæ ¸å¿ƒç±»æ„æˆï¼Œå‰ç«¯å°†ä¸»è¦ä¸å®ƒä»¬è¿›è¡Œäº¤äº’ï¼š

-   `NarrativeGenerator`ï¼šæ­¤ç±»è´Ÿè´£æ‰€æœ‰ **AIå†…å®¹çš„åˆ›ä½œ**ã€‚å½“ä½ éœ€è¦ç”Ÿæˆæ–°çš„æ•…äº‹èŠ‚ç‚¹ã€åœºæ™¯ã€äº‹ä»¶ã€åŠ¨ä½œï¼Œç”šè‡³æ˜¯ä¸ºä¸€ä¸ªè‡ªå®šä¹‰åŠ¨ä½œç”Ÿæˆ"æ•ˆæœ"æ—¶ï¼Œéƒ½å°†ä½¿ç”¨å®ƒã€‚
-   `NarrativeEditor`ï¼šæ­¤ç±»å¤„ç†æ‰€æœ‰ **ç”±ç”¨æˆ·é©±åŠ¨çš„ã€å¯¹ç°æœ‰æ•…äº‹èŠ‚ç‚¹çš„ä¿®æ”¹**ã€‚å¦‚æœç”¨æˆ·æƒ³è¦ä¿®æ”¹æ–‡æœ¬ã€åˆ é™¤åŠ¨ä½œæˆ–æ·»åŠ å¯¹è¯ï¼Œéƒ½å°†é€šè¿‡è¿™ä¸ªç±»æ¥å®Œæˆã€‚

è¿™ä¸¤ä¸ªç»„ä»¶éƒ½å›´ç»•ç€ä¸€ä¸ªæ ¸å¿ƒæ•°æ®ç»“æ„â€”â€”`Node`ï¼ˆèŠ‚ç‚¹ï¼‰è¿›è¡Œæ“ä½œã€‚

---

## 3. `Node` å¯¹è±¡ï¼šä½ çš„æ ¸å¿ƒæ•°æ®ç»“æ„

`Node` æ˜¯ä½ éœ€è¦å¤„ç†çš„ä¸»è¦å¯¹è±¡ã€‚åœ¨æ•…äº‹çš„ä»»ä½•æ—¶åˆ»ï¼Œå‰ç«¯ç•Œé¢ä¸Šå±•ç¤ºçš„éƒ½æ˜¯ä¸€ä¸ª`Node`å¯¹è±¡çš„å†…å®¹ã€‚å½“ä½ ä»åç«¯è·å–åˆ°ä¸€ä¸ª`Node`å¯¹è±¡æ—¶ï¼Œå¯ä»¥è°ƒç”¨å®ƒçš„ `.to_dict()` æ–¹æ³•ï¼Œå°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªæ˜“äºå¤„ç†çš„ã€JSONåºåˆ—åŒ–çš„å­—å…¸ã€‚

### `Node` ç»“æ„ç¤ºä¾‹

âš ï¸ **æ³¨æ„ï¼šä»¥ä¸‹æ˜¯ç®€åŒ–ç¤ºä¾‹ï¼Œå®Œæ•´çš„çœŸå®ç»“æ„è¯·æŸ¥çœ‹ [example_node_data.json](./example_node_data.json)**

```json
{
    "id": "a1b2c3d4-...",
    "scene": "ä¹æœˆçš„æ¸…æ™¨ï¼Œéœæ ¼æ²ƒèŒ¨åŸå ¡åœ¨è–„é›¾ä¸­è‹¥éšè‹¥ç°...å“ˆåˆ©æ³¨æ„åˆ°äººç¾¤ä¸­ä¸€ä¸ªæ ¼æ ¼ä¸å…¥çš„èº«å½±ã€‚",
    "node_type": "scene",
    "events": [
        {
            "id": "e1f2a3b4-...",
            "speaker": "è·¯äººç”²",
            "content": "å¬è¯´ä»Šå¹´æœ‰ä¸€ä¸ªå­¦ç”Ÿæ¥è‡ªé¥è¿œçš„ä¸œæ¬§...",
            "timestamp": 1,
            "event_type": "dialogue",
            "description": "",
            "actions": [],
            "metadata": {}
        }
    ],
    "outgoing_actions": [
        {
            "action": {
                "id": "action_1",
                "description": "å“ˆåˆ©å†³å®šè·Ÿéšé‚£ä¸ªé™Œç”Ÿçš„æ–°ç”Ÿï¼Œè¯•å›¾æ‚„æ‚„è§‚å¯Ÿä»–çš„åŠ¨å‘ã€‚",
                "is_key_action": true,
                "metadata": {
                    "navigation": "continue",
                    "response": "",
                    "effects": {
                        "world_state_changes": "å“ˆåˆ©çš„æ³¨æ„åŠ›å®Œå…¨è¢«ç¥ç§˜å­¦ç”Ÿå¸å¼•..."
                    }
                }
            },
            "target_node_id": null,
            "target_event": null
        }
    ],
    "metadata": {
        "world_state": {
            "time": "å¼€å­¦æ—¥æ¸…æ™¨",
            "location": "éœæ ¼æ²ƒèŒ¨åŸå ¡å…¥å£",
            "characters": {
                "å“ˆåˆ©": "å¥½å¥‡ä¸”è­¦æƒ•",
                "ç¥ç§˜æ–°ç”Ÿ": "è¡Œä¸ºå¯ç–‘ï¼Œèº«ä»½ä¸æ˜"
            },
            "key_facts": ["å“ˆåˆ©å‘ç°äº†ä¸€ä¸ªè¡Œä¸ºæ€ªå¼‚çš„æ–°ç”Ÿ"],
            "tension_level": 2
        }
    }
}
```

-   **`scene`**: æ•…äº‹çš„æ ¸å¿ƒå™äº‹æ–‡æœ¬ã€‚è¿™æ˜¯ç”¨æˆ·å°†é˜…è¯»å’Œç¼–è¾‘çš„ä¸»è¦å†…å®¹ã€‚
-   **`events`**: ä¸€ç³»åˆ—èƒŒæ™¯äº‹ä»¶ï¼ˆå¯¹è¯ã€ç¯å¢ƒæå†™ç­‰ï¼‰ï¼Œç”¨äºè¥é€ æ°›å›´ã€‚
-   **`outgoing_actions`**: ç”¨æˆ·å¯ä»¥åšå‡ºçš„é€‰æ‹©åˆ—è¡¨ã€‚æ¯ä¸ªåŠ¨ä½œéƒ½æœ‰ä¸€ä¸ª`description`ï¼ˆæè¿°ï¼‰å’Œ`metadata`ï¼ˆå…ƒæ•°æ®ï¼‰ï¼Œå…¶ä¸­åŒ…å«äº†`navigation`ç±»å‹ï¼ˆ`continue`æˆ–`stay`ï¼‰ã€‚
-   **`metadata.world_state`**: ä¸€ä¸ªåŒ…å«å½“å‰æ•…äº‹ä¸–ç•ŒçŠ¶æ€çš„å¯¹è±¡ã€‚åœ¨è°ƒç”¨ä»»ä½•ç”ŸæˆåŠŸèƒ½æ—¶ï¼Œéƒ½åº”å°†æ­¤çŠ¶æ€ä¼ å›åç«¯ï¼Œä»¥ä¿æŒä¸Šä¸‹æ–‡çš„è¿ç»­æ€§ã€‚

---

## 4. å‰ç«¯å¼€å‘æµç¨‹ä¸APIæŒ‡å—

æœ¬èŠ‚è¯¦ç»†ä»‹ç»äº†ä¸»è¦çš„ç”¨æˆ·å·¥ä½œæµç¨‹ï¼Œä»¥åŠä½ éœ€è¦è°ƒç”¨çš„ç›¸åº”åç«¯æ–¹æ³•ã€‚

### å·¥ä½œæµ1ï¼šå¼€å¯ä¸€ä¸ªæ–°æ•…äº‹

1.  **ç”¨æˆ·æ“ä½œ**ï¼šç”¨æˆ·è¾“å…¥ä»–ä»¬çš„æ•…äº‹åˆ›æ„ä»¥åŠä»»ä½•å¯é€‰çš„è®¾å®šï¼ˆä¸–ç•Œè§‚ã€è§’è‰²ã€é£æ ¼ç­‰ï¼‰ã€‚
2.  **å‰ç«¯è°ƒç”¨**ï¼š
    -   ä½¿ç”¨ç”¨æˆ·çš„è®¾å®šæ¥å®ä¾‹åŒ– `NarrativeGenerator`ã€‚
    -   è°ƒç”¨ `generator.bootstrap_node(idea)`ã€‚
3.  **åç«¯æ–¹æ³•**: `generator.bootstrap_node(idea: str) -> Node`
    -   **å‚æ•°**:
        -   `idea`: ç”¨æˆ·çš„åˆå§‹æ•…äº‹æ„æƒ³ï¼ˆå­—ç¬¦ä¸²ï¼‰ã€‚
    -   **è¿”å›**: å®Œå…¨ç”Ÿæˆå¥½çš„åˆå§‹ `Node` å¯¹è±¡ã€‚
4.  **å‰ç«¯å“åº”**ï¼š
    -   æ¥æ”¶ `first_node` å¯¹è±¡ã€‚
    -   ä» `first_node.metadata.get("world_state", {})` ä¸­æå–åˆå§‹ä¸–ç•ŒçŠ¶æ€ã€‚
    -   åœ¨èŠ‚ç‚¹ä¸Šè°ƒç”¨ `.to_dict()`ã€‚
    -   ä¸ºç”¨æˆ·æ¸²æŸ“ `scene`ã€`events` å’Œ `outgoing_actions`ã€‚
    -   å­˜å‚¨ `node` å¯¹è±¡å’Œ `state` å¯¹è±¡ï¼Œä»¥å¤‡åç»­ç¼–è¾‘æˆ–æ¨è¿›æ•…äº‹ã€‚

### å·¥ä½œæµ2ï¼šç¼–è¾‘å½“å‰èŠ‚ç‚¹ï¼ˆUGCå¾ªç¯ï¼‰

è¿™æ˜¯ `NarrativeEditor` å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚ä½ åªéœ€è¦ç”¨ `NarrativeGenerator` çš„å®ä¾‹æ¥åˆå§‹åŒ–å®ƒä¸€æ¬¡ã€‚

```python
# åœ¨ä½ çš„åç«¯æ¥å£æˆ–æœåŠ¡ä¸­
generator = NarrativeGenerator(llm_client, world_setting, ...)
editor = NarrativeEditor(generator)
```

#### åŠŸèƒ½1ï¼šé‡æ–°ç”Ÿæˆå†…å®¹

-   **ç”¨æˆ·æ“ä½œ**ï¼šç”¨æˆ·å¯¹æŸéƒ¨åˆ†ä¸æ»¡æ„ï¼Œç‚¹å‡»â€œé‡æ–°ç”Ÿæˆåœºæ™¯â€ã€‚
-   **åç«¯æ–¹æ³•**: `editor.regenerate_part(node: Node, part_to_regenerate: str, context: str = "") -> Node`
    -   **å‚æ•°**:
        -   `node`: å½“å‰çš„ `Node` å¯¹è±¡ã€‚
        -   `part_to_regenerate`: ä¸€ä¸ªå­—ç¬¦ä¸² - `'scene'`, `'events'`, æˆ– `'actions'`ã€‚
        -   `context`: (å¯é€‰) åŒ…å«ç”¨æˆ·æŒ‡å¯¼çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼šâ€œè®©å®ƒæ›´æµªæ¼«ä¸€ç‚¹â€ã€‚
    -   **è¿”å›**: åŒ…å«å·²é‡æ–°ç”Ÿæˆéƒ¨åˆ†çš„ã€ä¿®æ”¹åçš„ `Node` å¯¹è±¡ã€‚
-   **å‰ç«¯**: ä½¿ç”¨æ–°çš„ `Node` å¯¹è±¡ä¸­çš„å†…å®¹æ›´æ–°UIã€‚

#### åŠŸèƒ½2ï¼šç›´æ¥ç¼–è¾‘åœºæ™¯

-   **ç”¨æˆ·æ“ä½œ**ï¼šç”¨æˆ·åœ¨åœºæ™¯æ–‡æœ¬æ¡†ä¸­æ‰‹åŠ¨è¾“å…¥ä¿®æ”¹å¹¶ä¿å­˜ã€‚
-   **åç«¯æ–¹æ³•**: `editor.edit_scene(node: Node, new_scene_text: str) -> Node`
    -   **å‚æ•°**:
        -   `node`: å½“å‰çš„ `Node` å¯¹è±¡ã€‚
        -   `new_scene_text`: å®Œæ•´çš„ã€æ›´æ–°åçš„åœºæ™¯æ–‡æœ¬ã€‚
    -   **è¿”å›**: ä¿®æ”¹åçš„ `Node` å¯¹è±¡ã€‚

#### åŠŸèƒ½3ï¼šæ·»åŠ æ–°åŠ¨ä½œ

-   **ç”¨æˆ·æ“ä½œ**ï¼šç”¨æˆ·ç‚¹å‡»â€œæ·»åŠ åŠ¨ä½œâ€ï¼Œå¹¶å¡«å†™è¡¨å•ã€‚
-   **åç«¯æ–¹æ³•**: `editor.add_action(node: Node, description: str, navigation_type: str, effects: Optional[Dict] = None) -> Node`
    -   **å‚æ•°**:
        -   `node`: å½“å‰çš„ `Node` å¯¹è±¡ã€‚
        -   `description`: åŠ¨ä½œçš„æ–‡æœ¬ï¼Œä¾‹å¦‚ï¼šâ€œæŸ¥çœ‹åºŠåº•ä¸‹â€ã€‚
        -   `navigation_type`: å¿…é¡»æ˜¯ `'continue'` æˆ– `'stay'`ã€‚
        -   `effects`: (å¯é€‰) å¦‚æœç”¨æˆ·è‡ªå·±ç¼–å†™æ•ˆæœï¼Œè¯·å°†å…¶ä½œä¸ºå­—å…¸ä¼ å…¥ï¼š`{"response": "...", "effects": {"world_state_changes": "..."}}`ã€‚å¦‚æœä¼ å…¥ `None`ï¼ŒAIå°†è‡ªåŠ¨ç”Ÿæˆæ•ˆæœã€‚
    -   **è¿”å›**: æ·»åŠ äº†æ–°åŠ¨ä½œçš„ã€ä¿®æ”¹åçš„ `Node`ã€‚

#### åŠŸèƒ½4ï¼šç¼–è¾‘åŠ¨ä½œæ–‡æœ¬

-   **ç”¨æˆ·æ“ä½œ**ï¼šç”¨æˆ·ç‚¹å‡»åŠ¨ä½œæ—è¾¹çš„ç¼–è¾‘å›¾æ ‡å¹¶ä¿®æ”¹å…¶æ–‡æœ¬ã€‚
-   **åç«¯æ–¹æ³•**: `editor.edit_action_description(node: Node, action_id: str, new_description: str) -> Node`
    -   **å‚æ•°**:
        -   `node`: å½“å‰çš„ `Node` å¯¹è±¡ã€‚
        -   `action_id`: è¦ä¿®æ”¹çš„åŠ¨ä½œçš„IDã€‚
        -   `new_description`: åŠ¨ä½œçš„æ–°æ–‡æœ¬ã€‚
    -   **è¿”å›**: ä¿®æ”¹åçš„ `Node`ã€‚

#### åŠŸèƒ½5ï¼šåˆ é™¤åŠ¨ä½œ

-   **ç”¨æˆ·æ“ä½œ**ï¼šç”¨æˆ·ç‚¹å‡»åŠ¨ä½œæ—è¾¹çš„åˆ é™¤å›¾æ ‡ã€‚
-   **åç«¯æ–¹æ³•**: `editor.delete_action(node: Node, action_id: str) -> Node`
    -   **å‚æ•°**:
        -   `node`: å½“å‰çš„ `Node` å¯¹è±¡ã€‚
        -   `action_id`: è¦ç§»é™¤çš„åŠ¨ä½œçš„IDã€‚
    -   **è¿”å›**: ä¿®æ”¹åçš„ `Node`ã€‚

#### åŠŸèƒ½6ï¼šæ·»åŠ /åˆ é™¤äº‹ä»¶

-   **ç”¨æˆ·æ“ä½œ**ï¼šç”¨æˆ·æ·»åŠ æ–°çš„å¯¹è¯æˆ–åˆ é™¤ç°æœ‰äº‹ä»¶ã€‚
-   **åç«¯æ–¹æ³•**:
    -   `editor.add_dialogue_event(node: Node, speaker: str, content: str) -> Node`
    -   `editor.delete_event(node: Node, event_id: str) -> Node`
-   **è¿”å›**: ä¿®æ”¹åçš„ `Node` å¯¹è±¡ã€‚

### å·¥ä½œæµ3ï¼šæ¨è¿›æ•…äº‹

-   **ç”¨æˆ·æ“ä½œ**ï¼šç”¨æˆ·ç‚¹å‡»ä¸€ä¸ª `navigation: "continue"` çš„åŠ¨ä½œã€‚
-   **å‰ç«¯è°ƒç”¨**ï¼š
    -   ä½ æ‰‹å¤´æœ‰ `current_node`ã€æ‰€é€‰åŠ¨ä½œçš„ `action_id` ä»¥åŠå½“å‰çš„ `world_state`ã€‚
    -   è°ƒç”¨ä¸€ä¸ªåç«¯æ¥å£ï¼Œè¯¥æ¥å£ä¼šåŒ…è£…å¹¶æ‰§è¡Œ `generator.apply_action` æ–¹æ³•ã€‚
-   **åç«¯æ–¹æ³•**: `generator.apply_action(node: Node, action_id: str, state: dict) -> Tuple[Optional[Node], dict, str]`
    -   **å‚æ•°**:
        -   `node`: å½“å‰çš„ `Node` å¯¹è±¡ã€‚
        -   `action_id`: ç”¨æˆ·é€‰æ‹©çš„ `continue` åŠ¨ä½œçš„IDã€‚
        -   `state`: å½“å‰çš„ `world_state` å­—å…¸ã€‚
    -   **è¿”å›**: ä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…å«ï¼š
        1.  `next_node`: ä¸ºä¸‹ä¸€ä¸ªæ•…äº‹èŠ‚ç‚¹æ–°ç”Ÿæˆçš„ `Node` å¯¹è±¡ã€‚
        2.  `new_state`: æ›´æ–°åçš„ `world_state`ã€‚
        3.  `response_text`: ä¸€æ®µç¡®è®¤åŠ¨ä½œçš„æ–‡æœ¬ï¼Œä¾‹å¦‚ï¼šâ€œä½ é€‰æ‹©äº†æ‰“å¼€é—¨...â€ã€‚
-   **å‰ç«¯å“åº”**ï¼š
    -   æ¥æ”¶ `next_node` å’Œ `new_state`ã€‚
    -   ç”¨æ–°çš„èŠ‚ç‚¹å’ŒçŠ¶æ€æ›¿æ¢å½“å‰çš„ã€‚
    -   æ¸²æŸ“æ–°çš„åœºæ™¯ã€äº‹ä»¶å’ŒåŠ¨ä½œã€‚å¾ªç¯å¾€å¤ã€‚

---

## 5. ç”¨æˆ·è‡ªå®šä¹‰èŠ‚ç‚¹åˆ›å»ºä¸è¿æ¥

é™¤äº†AIç”Ÿæˆçš„å†…å®¹ï¼Œç³»ç»Ÿç°åœ¨æ”¯æŒç”¨æˆ·å®Œå…¨è‡ªå®šä¹‰åˆ›å»ºèŠ‚ç‚¹ï¼ŒåŒ…æ‹¬AIè¾…åŠ©åŠŸèƒ½ã€‚è¿™ä¸ºç”¨æˆ·æä¾›äº†æ›´å¤§çš„åˆ›ä½œè‡ªç”±åº¦ã€‚

### å·¥ä½œæµ4ï¼šç”¨æˆ·è‡ªå®šä¹‰èŠ‚ç‚¹åˆ›å»º

#### åŠŸèƒ½1ï¼šå®Œå…¨è‡ªå®šä¹‰èŠ‚ç‚¹åˆ›å»º

-   **ç”¨æˆ·æ“ä½œ**ï¼šç”¨æˆ·å†³å®šåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬åœºæ™¯ã€äº‹ä»¶å’ŒåŠ¨ä½œã€‚
-   **åç«¯æ–¹æ³•**: `editor.create_custom_node(scene_text: str, events: Optional[List[Dict]], actions: Optional[List[Dict]], world_state: Optional[Dict]) -> Node`
    -   **å‚æ•°**:
        -   `scene_text`: åœºæ™¯æè¿°æ–‡æœ¬
        -   `events`: å¯é€‰äº‹ä»¶åˆ—è¡¨ï¼Œæ ¼å¼: `[{"speaker": "...", "content": "...", "event_type": "dialogue/narration"}]`
        -   `actions`: å¯é€‰åŠ¨ä½œåˆ—è¡¨ï¼Œæ ¼å¼: `[{"description": "...", "navigation": "continue/stay", "effects": {...}}]`
        -   `world_state`: å¯é€‰çš„ä¸–ç•ŒçŠ¶æ€ä¿¡æ¯
    -   **è¿”å›**: åˆ›å»ºçš„å®Œæ•´ `Node` å¯¹è±¡

#### åŠŸèƒ½2ï¼šAIè¾…åŠ©èŠ‚ç‚¹åˆ›å»º

-   **ç”¨æˆ·æ“ä½œ**ï¼šç”¨æˆ·æä¾›ä¸€ä¸ªç®€å•çš„èŠ‚ç‚¹æè¿°ï¼Œå¸Œæœ›AIå¸®åŠ©æ¶¦è‰²å’Œå®Œå–„ã€‚
-   **æ ¸å¿ƒæ–¹æ³•**:
    -   **åœºæ™¯æ¶¦è‰²**: `editor.polish_scene_description(raw_description: str, context: str) -> str`
        -   å°†ç”¨æˆ·çš„ç®€å•æè¿°æ¶¦è‰²æˆä¼˜ç¾çš„åœºæ™¯æ–‡æœ¬
    -   **ç”Ÿæˆäº‹ä»¶**: `editor.generate_events_for_scene(scene_description: str, context: str) -> List[Dict]`
        -   æ ¹æ®åœºæ™¯è‡ªåŠ¨ç”Ÿæˆé…å¥—çš„èƒŒæ™¯äº‹ä»¶å’Œå¯¹è¯
    -   **ç”ŸæˆåŠ¨ä½œ**: `editor.generate_actions_for_scene(scene_description: str, context: str, current_state: Dict) -> List[Dict]`
        -   æ ¹æ®åœºæ™¯ç”Ÿæˆåˆé€‚çš„ç©å®¶åŠ¨ä½œé€‰é¡¹
    -   **ä¸€é”®åˆ›å»º**: `editor.create_assisted_node(raw_description: str, polish_scene: bool, generate_events: bool, generate_actions: bool, context: str, world_state: Optional[Dict]) -> Node`
        -   æ•´åˆä»¥ä¸Šæ‰€æœ‰åŠŸèƒ½ï¼Œä¸€æ¬¡æ€§åˆ›å»ºå®Œæ•´çš„AIè¾…åŠ©èŠ‚ç‚¹

#### åŠŸèƒ½3ï¼šèŠ‚ç‚¹å¢å¼º

-   **ç”¨æˆ·æ“ä½œ**ï¼šç”¨æˆ·å¯¹ç°æœ‰èŠ‚ç‚¹ä¸æ»¡æ„ï¼Œå¸Œæœ›AIé‡æ–°ç”Ÿæˆæˆ–å¢å¼ºæŸäº›éƒ¨åˆ†ã€‚
-   **åç«¯æ–¹æ³•**: `editor.enhance_existing_node(node: Node, regenerate_events: bool, regenerate_actions: bool, polish_scene: bool, context: str) -> Node`
    -   **å‚æ•°**:
        -   `node`: ç°æœ‰èŠ‚ç‚¹
        -   `regenerate_events`: æ˜¯å¦é‡æ–°ç”Ÿæˆäº‹ä»¶
        -   `regenerate_actions`: æ˜¯å¦é‡æ–°ç”ŸæˆåŠ¨ä½œ
        -   `polish_scene`: æ˜¯å¦é‡æ–°æ¶¦è‰²åœºæ™¯
        -   `context`: å¢å¼ºæŒ‡å¯¼è¯­
    -   **è¿”å›**: å¢å¼ºåçš„èŠ‚ç‚¹

### å·¥ä½œæµ5ï¼šèŠ‚ç‚¹è¿æ¥ç®¡ç†

ç³»ç»Ÿæä¾›äº†å®Œæ•´çš„èŠ‚ç‚¹è¿æ¥ç®¡ç†åŠŸèƒ½ï¼Œè®©ç”¨æˆ·å¯ä»¥è‡ªç”±æ„å»ºæ•…äº‹å›¾ç»“æ„ã€‚

#### åŠŸèƒ½1ï¼šè¿æ¥èŠ‚ç‚¹

-   **åç«¯æ–¹æ³•**: `editor.connect_nodes(from_node: Node, to_node: Node, action_description: str, navigation_type: str, action_effects: Optional[Dict]) -> bool`
    -   åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´å»ºç«‹è¿æ¥ï¼Œé€šè¿‡ä¸€ä¸ªåŠ¨ä½œå®ç°è·³è½¬

#### åŠŸèƒ½2ï¼šæŸ¥çœ‹è¿æ¥

-   **åç«¯æ–¹æ³•**: `editor.get_node_connections(node: Node) -> Dict[str, List[Dict]]`
    -   è¿”å›èŠ‚ç‚¹çš„æ‰€æœ‰å…¥å‘å’Œå‡ºå‘è¿æ¥ä¿¡æ¯

#### åŠŸèƒ½3ï¼šæ•…äº‹åˆ†æ”¯

-   **åç«¯æ–¹æ³•**: `editor.create_story_branch(from_node: Node, branch_choices: List[Tuple[str, str]]) -> List[Node]`
    -   ä»ä¸€ä¸ªèŠ‚ç‚¹åˆ›å»ºå¤šä¸ªåˆ†æ”¯è·¯å¾„ï¼Œæ¯ä¸ªåˆ†æ”¯æ˜¯ä¸€ä¸ª `(åŠ¨ä½œæè¿°, åœºæ™¯æ–‡æœ¬)` å¯¹

#### åŠŸèƒ½4ï¼šèŠ‚ç‚¹å…‹éš†

-   **åç«¯æ–¹æ³•**: `editor.clone_node(original_node: Node, modify_scene: str) -> Node`
    -   å…‹éš†ç°æœ‰èŠ‚ç‚¹ï¼Œå¯é€‰æ‹©æ€§ä¿®æ”¹åœºæ™¯å†…å®¹

### å·¥ä½œæµ6ï¼šæ•…äº‹å›¾ç®¡ç†

-   **æ•…äº‹å›¾æ¦‚è§ˆ**: `editor.get_story_graph_overview() -> Dict[str, Any]`
    -   è·å–æ•´ä¸ªæ•…äº‹å›¾çš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬èŠ‚ç‚¹æ•°ã€è¿æ¥æ•°ã€å­¤ç«‹èŠ‚ç‚¹ç­‰
-   **å›¾éªŒè¯**: `editor.narrative_graph.validate_graph() -> Dict[str, List[str]]`
    -   æ£€æŸ¥æ•…äº‹å›¾çš„å®Œæ•´æ€§å’Œæœ‰æ•ˆæ€§
-   **å¯¼å‡º**: `editor.narrative_graph.to_json() -> str`
    -   å°†å®Œæ•´æ•…äº‹å›¾å¯¼å‡ºä¸ºJSONæ ¼å¼

---

## 6. ä½¿ç”¨ç¤ºä¾‹

### ç®€å•çš„AIè¾…åŠ©èŠ‚ç‚¹åˆ›å»ºç¤ºä¾‹

```python
# åˆå§‹åŒ–
generator = NarrativeGenerator(llm_client, world_setting="ç§‘å¹»ä¸–ç•Œ")
editor = NarrativeEditor(generator)

# ç”¨æˆ·è¾“å…¥ç®€å•æè¿°
raw_idea = "ä¸»è§’æ¥åˆ°äº†ä¸€ä¸ªç¥ç§˜çš„å®éªŒå®¤"

# AIè¾…åŠ©åˆ›å»ºå®Œæ•´èŠ‚ç‚¹
node = editor.create_assisted_node(
    raw_description=raw_idea,
    polish_scene=True,           # æ¶¦è‰²åœºæ™¯
    generate_events=True,        # ç”ŸæˆèƒŒæ™¯äº‹ä»¶
    generate_actions=True,       # ç”ŸæˆåŠ¨ä½œé€‰é¡¹
    context="è¥é€ ç´§å¼ ç§‘å¹»æ°›å›´",
    world_state={"location": "åœ°ä¸‹å®éªŒå®¤", "tension_level": 8}
)

# è·å–ç»“æœ
print(f"æ¶¦è‰²ååœºæ™¯: {node.scene}")
print(f"ç”Ÿæˆäº‹ä»¶æ•°: {len(node.events)}")
print(f"ç”ŸæˆåŠ¨ä½œæ•°: {len(node.outgoing_actions)}")
```

### èŠ‚ç‚¹è¿æ¥ç¤ºä¾‹

```python
# åˆ›å»ºä¸¤ä¸ªèŠ‚ç‚¹
node1 = editor.create_quick_node("ä¸»è§’å‘ç°äº†ä¸€æ‰‡éšè—çš„é—¨")
node2 = editor.create_quick_node("é—¨åæ˜¯ä¸€ä¸ªå·¨å¤§çš„æœºå™¨å®¤")

# è¿æ¥èŠ‚ç‚¹
success = editor.connect_nodes(
    from_node=node1,
    to_node=node2,
    action_description="æ¨å¼€éšè—çš„é—¨",
    navigation_type="continue",
    action_effects={
        "response": "é—¨ç¼“ç¼“æ‰“å¼€ï¼Œéœ²å‡ºäº†å†…éƒ¨çš„æƒ…å†µ",
        "effects": {"world_state_changes": "å‘ç°äº†æ–°åŒºåŸŸ"}
    }
)

# æŸ¥çœ‹è¿æ¥ä¿¡æ¯
connections = editor.get_node_connections(node1)
print(f"å‡ºå‘è¿æ¥: {len(connections['outgoing'])}")
```

è¿™äº›åŠŸèƒ½è®©ç”¨æˆ·æ—¢èƒ½äº«å—AIç”Ÿæˆçš„ä¾¿åˆ©ï¼Œåˆèƒ½ä¿æŒå®Œå…¨çš„åˆ›ä½œæ§åˆ¶æƒï¼Œå®ç°çœŸæ­£çš„äººæœºåä½œå¼å™äº‹åˆ›ä½œã€‚ 